<?import com.comp2042.tetris.view.OverlayPanel?>
<?import javafx.scene.Group?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import java.net.URL?>
<StackPane fx:controller="com.comp2042.tetris.controller.GuiController"
           prefHeight="720" prefWidth="900"
           maxHeight="720" maxWidth="900"
           xmlns:fx="http://javafx.com/fxml"
           styleClass="root">
    <children>
        <Pane>
            <Pane fx:id="background1" styleClass="starBackground" prefWidth="900" prefHeight="720" />

            <Pane fx:id="background2" styleClass="starBackground" prefWidth="900" prefHeight="720" layoutY="-720" />
        </Pane>
        <Pane fx:id="pixelStarLayer" mouseTransparent="true" pickOnBounds="false" prefWidth="900" prefHeight="720" />
        <HBox fx:id="mainContent" alignment="CENTER" spacing="50" visible="false" managed="false">
            <VBox alignment="TOP_LEFT" spacing="15" styleClass="side-panel" style="-fx-padding: 60 0 0 0;">
                <VBox spacing="0">
                    <Label text="SCORE :" styleClass="score-title"/>
                    <StackPane styleClass="scoreBoard" alignment="CENTER_LEFT">
                        <Label fx:id="scoreLabel" text="0" styleClass="scoreClass"/>
                    </StackPane>
                </VBox>
                <VBox spacing="0">
                    <Label text="TIME :" styleClass="timer-title"/>
                    <StackPane styleClass="timerBoard" alignment="CENTER_LEFT">
                        <Label fx:id="timerLabel" text="00:00" styleClass="timerClass"/>
                    </StackPane>
                </VBox>
            </VBox>

            <StackPane alignment="CENTER" style="-fx-translate-y: -6;">
                <BorderPane fx:id="gameBoard" styleClass="gameBoard" maxWidth="264" maxHeight="424">
                    <center>
                        <GridPane fx:id="gamePanel" hgap="0" vgap="0"/>
                    </center>
                </BorderPane>
                <Pane fx:id="ghostBrickLayer" mouseTransparent="true" pickOnBounds="false" maxWidth="240" maxHeight="380">
                    <GridPane fx:id="ghostBrickPanel" hgap="0" vgap="0"/>
                </Pane>
                <Pane fx:id="activeBrickLayer" mouseTransparent="true" pickOnBounds="false" maxWidth="240" maxHeight="380">
                    <GridPane fx:id="brickPanel" hgap="0" vgap="0"/>
                </Pane>

            </StackPane>

            <VBox alignment="CENTER" spacing="20" styleClass="side-panel">
                <Label text="NEXT :" styleClass="panel-title"/>
                <BorderPane styleClass="nextBoard">
                    <center>
                        <GridPane fx:id="nextBrickPanel" hgap="0" vgap="0" alignment="CENTER" maxWidth="100" maxHeight="290"/>
                    </center>
                </BorderPane>
            </VBox>
        </HBox>
        <StackPane fx:id="pauseMenuOverlay" styleClass="pause-menu-overlay" visible="false" managed="false" StackPane.alignment="CENTER">
            <VBox fx:id="pauseMenuCard" spacing="12" alignment="CENTER" styleClass="pause-menu-card">
                <Label text="PAUSED" styleClass="pause-menu-title"/>
                <VBox alignment="CENTER" spacing="6">
                    <Button onAction="#resumeGame" styleClass="pause-btn, pause-btn-primary">
                        <graphic>
                            <Label text="▶ Resume" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#openMusicControl" styleClass="pause-btn">
                        <graphic>
                            <Label text="♪ Music" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#startNewGameFromPause" styleClass="pause-btn">
                        <graphic>
                            <Label text="↻ New" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#goToMainMenuFromPause" styleClass="pause-btn">
                        <graphic>
                            <Label text="◄ Menu" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#endGameFromPause" styleClass="pause-btn, pause-btn-danger">
                        <graphic>
                            <Label text="✕ Exit" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                </VBox>
            </VBox>
        </StackPane>
        <StackPane fx:id="mainMenuOverlay" styleClass="main-menu-overlay" visible="true" managed="true" StackPane.alignment="CENTER">
            <VBox fx:id="mainMenuCard" spacing="28" alignment="CENTER" styleClass="menu-card">
                <VBox alignment="CENTER" spacing="6" styleClass="menu-title">
                    <Label text="GAlAXY" styleClass="title-galaxy"/>
                    <HBox alignment="CENTER" spacing="4" styleClass="title-tetris">
                        <Label text="T" styleClass="title-tetris-letter, letter-red"/>
                        <Label text="E" styleClass="title-tetris-letter, letter-orange"/>
                        <Label text="T" styleClass="title-tetris-letter, letter-yellow"/>
                        <Label text="R" styleClass="title-tetris-letter, letter-green"/>
                        <Label text="I" styleClass="title-tetris-letter, letter-cyan"/>
                        <Label text="S" styleClass="title-tetris-letter, letter-purple"/>
                    </HBox>
                </VBox>
                <VBox alignment="CENTER" spacing="10">
                    <Button onAction="#handleStartGame" styleClass="menu-button">
                        <graphic>
                            <HBox alignment="CENTER" spacing="6">
                                <Label text="◀" styleClass="menu-button-arrow"/>
                                <Label text="Start Game" styleClass="menu-button-label"/>
                                <Label text="▶" styleClass="menu-button-arrow"/>
                            </HBox>
                        </graphic>
                    </Button>
                    <Button onAction="#exitGame" styleClass="menu-button, danger">
                        <graphic>
                            <HBox alignment="CENTER" spacing="6">
                                <Label text="◀" styleClass="menu-button-arrow"/>
                                <Label text="Exit Game" styleClass="menu-button-label"/>
                                <Label text="▶" styleClass="menu-button-arrow"/>
                            </HBox>
                        </graphic>
                    </Button>
                </VBox>
            </VBox>
        </StackPane>

        <!-- Level Selection Overlay: appears after pressing Start Game -->
        <StackPane fx:id="levelSelectOverlay" styleClass="pause-menu-overlay" visible="false" managed="false" StackPane.alignment="CENTER">
            <VBox spacing="16" alignment="CENTER" styleClass="level-menu-card">
                <Label text="CHOOSE YOUR LEVEL" styleClass="pause-menu-title"/>
                <VBox alignment="CENTER" spacing="8">
                    <Button onAction="#handleLevelClassic" styleClass="pause-btn, pause-btn">
                        <graphic>
                            <Label text="Classic" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#handleLevelL1" styleClass="pause-btn">
                        <graphic>
                            <Label text="L1" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#handleLevelL2" styleClass="pause-btn">
                        <graphic>
                            <Label text="L2" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                </VBox>
                <Button onAction="#cancelLevelSelect" styleClass="pause-btn">
                    <graphic>
                        <Label text="◄ Back" styleClass="pause-btn-label"/>
                    </graphic>
                </Button>
            </VBox>
        </StackPane>

        <ImageView fx:id="staticScreen" fitWidth="900" fitHeight="720" visible="true" managed="true" mouseTransparent="true" preserveRatio="false" />

        <!-- Curtain Animation - Covers entire window (900x720) -->
        <Pane fx:id="curtainLeft" styleClass="curtain" visible="false" managed="false"
              prefWidth="900" prefHeight="720" maxWidth="900" maxHeight="720" minWidth="900" minHeight="720"
              StackPane.alignment="CENTER"/>
        <Pane fx:id="curtainRight" styleClass="curtain" visible="false" managed="false"
              prefWidth="900" prefHeight="720" maxWidth="900" maxHeight="720" minWidth="900" minHeight="720"
              StackPane.alignment="CENTER"/>

        <Pane styleClass="frontFrame" mouseTransparent="true"/>

        <!-- Score notification popups group -->
        <Group fx:id="groupNotification" StackPane.alignment="CENTER" mouseTransparent="true" pickOnBounds="false">
            <children>
                <!-- Debug label shown when rotation/notification events fire (hidden by default) -->
                <Label fx:id="debugNotificationLabel" text="" visible="false" styleClass="debug-notification" />
            </children>
        </Group>

        <!-- Game Over Panel (separate from notifications) -->
        <StackPane StackPane.alignment="CENTER" mouseTransparent="true" pickOnBounds="false">
            <OverlayPanel fx:id="gameOverPanel" message="GAME OVER"/>
        </StackPane>

        <!-- Confirmation Dialog -->
        <StackPane fx:id="confirmationOverlay" styleClass="confirmation-overlay" visible="false" managed="false" StackPane.alignment="CENTER">
            <VBox spacing="20" alignment="CENTER" styleClass="confirmation-card">
                <Label fx:id="confirmationMessage" text="Are you sure?" styleClass="confirmation-title"/>
                <HBox spacing="10" alignment="CENTER">
                    <Button onAction="#confirmAction" styleClass="pause-btn, pause-btn-danger">
                        <graphic>
                            <Label text="✓ Yes" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#cancelAction" styleClass="pause-btn-primary">
                        <graphic>
                            <Label text="✕ No" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                </HBox>
            </VBox>
        </StackPane>

        <!-- Music Control Panel -->
        <StackPane fx:id="musicControlOverlay" styleClass="music-overlay" visible="false" managed="false" StackPane.alignment="CENTER">
             <VBox spacing="12" alignment="CENTER" styleClass="music-card">
                <Label text="MUSIC" styleClass="settings-title"/>
                <VBox spacing="8" alignment="CENTER">
                    <Label text="Music: Coming Soon" styleClass="setting-item"/>
                    <Label text="Sound FX: Coming Soon" styleClass="setting-item"/>
                </VBox>
                <Button onAction="#closeMusicControl" styleClass="pause-btn">
                    <graphic>
                        <Label text="◄ Back" styleClass="pause-btn-label"/>
                    </graphic>
                </Button>
            </VBox>
        </StackPane>

        <!-- Game Over Screen -->
        <StackPane fx:id="gameOverOverlay" visible="false" managed="false" StackPane.alignment="CENTER" prefWidth="100" prefHeight="120">
        </StackPane>

        <Button fx:id="pauseButton"
                onAction="#pauseGame"
                styleClass="pause-button"
                StackPane.alignment="BOTTOM_LEFT"
                style="-fx-translate-x: 158; -fx-translate-y: -90;"
                visible="false"
                managed="false">
            <graphic>
                <Label text="⏯" style="-fx-text-fill: #ffffff; -fx-font-family: 'Press Start 2P'; -fx-font-size: 22px; -fx-translate-y: -3;"/>
            </graphic>
        </Button>
    </children>
    <stylesheets>
        <URL value="@window_style.css"/>
    </stylesheets>
</StackPane>
