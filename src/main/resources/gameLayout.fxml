<?import com.comp2042.tetris.view.OverlayPanel?>
<?import javafx.scene.Group?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.control.Slider?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.shape.Rectangle?>
<?import java.net.URL?>
<StackPane fx:controller="com.comp2042.tetris.controller.GuiController"
           prefHeight="720" prefWidth="900"
           maxHeight="720" maxWidth="900"
           xmlns:fx="http://javafx.com/fxml"
           styleClass="root">
    <children>


        <!-- Star animation layer - placed early so it appears behind UI elements -->
        <Pane fx:id="pixelStarLayer" mouseTransparent="true" pickOnBounds="false" prefWidth="900" prefHeight="720" opacity="4" visible="true" managed="true">
        </Pane>

        <HBox fx:id="mainContent" alignment="CENTER" spacing="50" visible="false" managed="false">
            <VBox alignment="TOP_LEFT" spacing="15" styleClass="side-panel" style="-fx-padding: 60 0 0 0;">
                <VBox spacing="0">
                    <Label text="SCORE :" styleClass="score-title"/>
                    <StackPane styleClass="scoreBoard" alignment="CENTER_LEFT">
                        <Label fx:id="scoreLabel" text="0" styleClass="scoreClass"/>
                    </StackPane>
                </VBox>
                <VBox spacing="0">
                    <Label text="TIME :" styleClass="timer-title"/>
                    <StackPane styleClass="timerBoard" alignment="CENTER_LEFT">
                        <Label fx:id="timerLabel" text="00:00" styleClass="timerClass"/>
                    </StackPane>
                </VBox>
            </VBox>

            <StackPane alignment="CENTER" style="-fx-translate-y: -6;">
                <BorderPane fx:id="gameBoard" styleClass="gameBoard" maxWidth="264" maxHeight="424">
                    <center>
                        <GridPane fx:id="gamePanel" hgap="0" vgap="0"/>
                    </center>
                </BorderPane>
                <Pane fx:id="ghostBrickLayer" mouseTransparent="true" pickOnBounds="false" maxWidth="240" maxHeight="380">
                    <GridPane fx:id="ghostBrickPanel" hgap="0" vgap="0"/>
                </Pane>
                <Pane fx:id="activeBrickLayer" mouseTransparent="true" pickOnBounds="false" maxWidth="240" maxHeight="380">
                    <GridPane fx:id="brickPanel" hgap="0" vgap="0"/>
                </Pane>

            </StackPane>

            <VBox alignment="CENTER" spacing="20" styleClass="side-panel">
                <Label fx:id="nextTitleLabel" text="NEXT :" styleClass="panel-title"/>
                <BorderPane styleClass="nextBoard">
                    <center>
                        <GridPane fx:id="nextBrickPanel" hgap="0" vgap="0" alignment="CENTER" maxWidth="100" maxHeight="290"/>
                    </center>
                </BorderPane>
            </VBox>
        </HBox>
        <StackPane fx:id="pauseMenuOverlay" styleClass="pause-menu-overlay" visible="false" managed="false" StackPane.alignment="CENTER">
            <VBox fx:id="pauseMenuCard" spacing="12" alignment="CENTER" styleClass="pause-menu-card">
                <Label text="PAUSED" styleClass="settings-title"/>
                <VBox alignment="CENTER" spacing="6">
                    <Button onAction="#resumeGame" styleClass="pause-btn, pause-btn-primary">
                        <graphic>
                            <Label text="â–¶ Resume" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#openMusicControl" styleClass="pause-btn">
                        <graphic>
                            <Label text="â™ª Music" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#startNewGameFromPause" styleClass="pause-btn">
                        <graphic>
                            <Label text="â†» New" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#goToMainMenuFromPause" styleClass="pause-btn">
                        <graphic>
                            <Label text="â—„ Menu" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#endGameFromPause" styleClass="pause-btn, pause-btn-danger">
                        <graphic>
                            <Label text="âœ• Exit" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                </VBox>
            </VBox>
        </StackPane>
        <StackPane fx:id="mainMenuOverlay" styleClass="main-menu-overlay" visible="true" managed="true" StackPane.alignment="CENTER">
            <VBox fx:id="mainMenuCard" spacing="28" alignment="CENTER" styleClass="menu-card">
                <VBox alignment="CENTER" spacing="6" styleClass="menu-title">
                    <Label text="GAlAXY" styleClass="title-galaxy"/>
                    <HBox alignment="CENTER" spacing="4" styleClass="title-tetris">
                        <Label text="T" styleClass="title-tetris-letter, letter-red"/>
                        <Label text="E" styleClass="title-tetris-letter, letter-orange"/>
                        <Label text="T" styleClass="title-tetris-letter, letter-yellow"/>
                        <Label text="R" styleClass="title-tetris-letter, letter-green"/>
                        <Label text="I" styleClass="title-tetris-letter, letter-cyan"/>
                        <Label text="S" styleClass="title-tetris-letter, letter-purple"/>
                    </HBox>
                </VBox>
                <VBox alignment="CENTER" spacing="10">
                    <Button onAction="#handleStartGame" styleClass="menu-button">
                        <graphic>
                            <HBox alignment="CENTER" spacing="6">
                                <Label text="â—€" styleClass="menu-button-arrow"/>
                                <Label text="Start Game" styleClass="menu-button-label"/>
                                <Label text="â–¶" styleClass="menu-button-arrow"/>
                            </HBox>
                        </graphic>
                    </Button>
                    <Button onAction="#exitGame" styleClass="menu-button, danger">
                        <graphic>
                            <HBox alignment="CENTER" spacing="6">
                                <Label text="â—€" styleClass="menu-button-arrow"/>
                                <Label text="Exit Game" styleClass="menu-button-label"/>
                                <Label text="â–¶" styleClass="menu-button-arrow"/>
                            </HBox>
                        </graphic>
                    </Button>
                </VBox>
            </VBox>
            <Button onAction="#openMusicControl" styleClass="pause-btn-small" StackPane.alignment="BOTTOM_RIGHT" style="-fx-translate-x: -158; -fx-translate-y: -90;">
                <graphic>
                    <Label text="ðŸ”Š" style="-fx-text-fill: #ffffff; -fx-font-family: 'Press Start 2P'; -fx-font-size: 13px; -fx-translate-y: -1;"/>
                </graphic>
            </Button>
            <Button onAction="#openTutorial" styleClass="pause-btn-small" StackPane.alignment="BOTTOM_LEFT" style="-fx-translate-x: 158; -fx-translate-y: -90;">
                <graphic>
                    <Label text="â“" style="-fx-text-fill: #ffffff; -fx-font-family: 'Press Start 2P'; -fx-font-size: 13px; -fx-translate-y: -1;"/>
                </graphic>
            </Button>
        </StackPane>

        <!-- Level Selection Overlay: appears after pressing Start Game -->
        <StackPane fx:id="levelSelectOverlay" styleClass="pause-menu-overlay" visible="false" managed="false" StackPane.alignment="CENTER">
            <VBox spacing="16" alignment="CENTER" styleClass="level-menu-card">
                <Label text="CHOOSE YOUR LEVEL" styleClass="settings-title"/>
                <VBox alignment="CENTER" spacing="8">
                    <!-- Classic button: StackPane wrapper so hint overlays the button without affecting layout -->
                    <StackPane styleClass="level-hint-container" alignment="CENTER">
                        <Button fx:id="levelClassicButton" onAction="#handleLevelClassic" styleClass="pause-btn, level-classic">
                            <graphic>
                                <Label text="Classic" styleClass="pause-btn-label"/>
                            </graphic>
                        </Button>
                        <!-- Hint label removed here; Popup-based hint in controller will handle showing the description to avoid duplicates -->
                    </StackPane>
                    <Button fx:id="levelL1Button" onAction="#handleLevelL1" styleClass="pause-btn, level-l1">
                        <graphic>
                            <Label text="TurboRush" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button fx:id="levelL2Button" onAction="#handleLevelL2" styleClass="pause-btn, level-l2">
                        <graphic>
                            <Label text="QuadLock" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button fx:id="levelL3Button" onAction="#handleLevelL3" styleClass="pause-btn, level-l3">
                        <graphic>
                            <Label text="Disorder Zone" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                </VBox>
                <Button onAction="#cancelLevelSelect" styleClass="pause-btn, back-black">
                    <graphic>
                        <Label text="â—„ Back" styleClass="pause-btn-label"/>
                    </graphic>
                </Button>
            </VBox>
        </StackPane>

        <ImageView fx:id="staticScreen" fitWidth="900" fitHeight="720" visible="true" managed="true" mouseTransparent="true" preserveRatio="false" />

        <!-- Curtain Animation - Covers entire window (900x720) -->
        <Pane fx:id="curtainLeft" styleClass="curtain" visible="false" managed="false"
              prefWidth="900" prefHeight="720" maxWidth="900" maxHeight="720" minWidth="900" minHeight="720"
              StackPane.alignment="CENTER"/>
        <Pane fx:id="curtainRight" styleClass="curtain" visible="false" managed="false"
              prefWidth="900" prefHeight="720" maxWidth="900" maxHeight="720" minWidth="900" minHeight="720"
              StackPane.alignment="CENTER"/>

        <Pane styleClass="frontFrame" mouseTransparent="true"/>


        <!-- Score notification popups group -->
        <Group fx:id="groupNotification" StackPane.alignment="CENTER" mouseTransparent="true" pickOnBounds="false">
            <children>
                <!-- Debug label shown when rotation/notification events fire (hidden by default) -->
                <Label fx:id="debugNotificationLabel" text="" visible="false" styleClass="debug-notification" />
            </children>
        </Group>

        <!-- Game Over Panel (separate from notifications) -->
        <StackPane StackPane.alignment="CENTER" mouseTransparent="true" pickOnBounds="false">
            <OverlayPanel fx:id="gameOverPanel" message="GAME OVER"/>
        </StackPane>

        <!-- Confirmation Dialog -->
        <StackPane fx:id="confirmationOverlay" styleClass="confirmation-overlay" visible="false" managed="false" StackPane.alignment="CENTER">
            <VBox spacing="20" alignment="CENTER" styleClass="confirmation-card">
                <Label fx:id="confirmationMessage" text="Are you sure?" styleClass="confirmation-title"/>
                <HBox spacing="10" alignment="CENTER">
                    <Button onAction="#confirmAction" styleClass="pause-btn, pause-btn-danger">
                        <graphic>
                            <Label text="âœ“ Yes" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                    <Button onAction="#cancelAction" styleClass="pause-btn-primary">
                        <graphic>
                            <Label text="âœ• No" styleClass="pause-btn-label"/>
                        </graphic>
                    </Button>
                </HBox>
            </VBox>
        </StackPane>

        <!-- Music Control Panel -->
        <StackPane fx:id="musicControlOverlay" styleClass="music-overlay" visible="false" managed="false" StackPane.alignment="CENTER">
             <VBox spacing="12" alignment="CENTER" styleClass="music-card">
                <Label text="MUSIC" styleClass="settings-title"/>
                <VBox spacing="8" alignment="CENTER">
                    <HBox alignment="CENTER" spacing="8">
                        <Label text="Music Volume" styleClass="setting-item" />
                        <Slider fx:id="musicVolumeSlider" min="0" max="100" prefWidth="220" />
                    </HBox>
                    <HBox alignment="CENTER" spacing="8">
                        <Label text="SFX Volume" styleClass="setting-item" />
                        <Slider fx:id="sfxVolumeSlider" min="0" max="100" prefWidth="220" />
                    </HBox>
                </VBox>
                <Button onAction="#closeMusicControl" styleClass="pause-btn">
                    <graphic>
                        <Label text="â—„ Back" styleClass="pause-btn-label"/>
                    </graphic>
                </Button>
            </VBox>
        </StackPane>

        <!-- Tutorial Panel -->
        <StackPane fx:id="tutorialOverlay" styleClass="music-overlay" visible="false" managed="false" StackPane.alignment="CENTER" style="-fx-background-radius: 10;">
             <VBox spacing="12" alignment="CENTER" styleClass="tutorial-card">
                <Label text="HOW TO PLAY" styleClass="settings-title"/>
                <VBox spacing="8" alignment="CENTER">
                    <Label text="Use arrow keys to move left/right and rotate." styleClass="setting-item" />
                    <Label text="Press spacebar to drop the brick instantly." styleClass="setting-item" />
                    <Label text="Clear full lines to score points." styleClass="setting-item" />
                    <Label text="Game over when bricks reach the top." styleClass="setting-item" />
                </VBox>
                <Button onAction="#closeTutorial" styleClass="pause-btn">
                    <graphic>
                        <Label text="â—„ Back" styleClass="pause-btn-label"/>
                    </graphic>
                </Button>
            </VBox>
        </StackPane>

        <!-- Game Over Screen -->
        <StackPane fx:id="gameOverOverlay" visible="false" managed="false" StackPane.alignment="CENTER" prefWidth="100" prefHeight="120">
        </StackPane>

        <Button fx:id="pauseButton"
                onAction="#pauseGame"
                styleClass="pause-btn-small"
                StackPane.alignment="BOTTOM_LEFT"
                style="-fx-translate-x: 158; -fx-translate-y: -90;"
                visible="false"
                managed="false">
            <graphic>
                <Label text="âšâš" style="-fx-text-fill: #ffffff; -fx-font-family: 'Press Start 2P'; -fx-font-size: 13px; -fx-translate-y: -1;"/>
            </graphic>
        </Button>
    </children>
    <stylesheets>
        <URL value="@window_style.css"/>
    </stylesheets>
</StackPane>
